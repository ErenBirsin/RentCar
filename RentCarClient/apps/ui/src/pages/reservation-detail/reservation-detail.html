<!-- Header -->
<section class="profile-header py-4 bg-primary text-white">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-8">
        <div class="profile-welcome">
          <div class="user-avatar">
            <img
              src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRNBRW6kw4PvewS5EGHKY7nNsJiWvrbsVIzZA&s"
              [alt]="fullName()"
              class="avatar-img"
            />
            <div class="avatar-badge">
              <i class="bi bi-check-circle-fill"></i>
            </div>
          </div>
          <div class="welcome-text">
            <h1 class="h2 mb-1">Hoş geldin, {{ customer().firstName }}!</h1>
            <p class="mb-0">Rezervasyon detayını buradan görüntüleyebilirsin</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Main Content -->
<section class="profile-main py-5">
  <div class="container">
    <div class="row">
      <!-- Sidebar -->
      <div class="col-lg-3">
        <div class="profile-sidebar">
          <div class="sidebar-card user-info">
            <div class="user-avatar-large">
              <img
                src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRNBRW6kw4PvewS5EGHKY7nNsJiWvrbsVIzZA&s"
                [alt]="fullName()"
                class="avatar-img"
              />
            </div>
            <div class="user-details">
              <h4>{{ fullName() }}</h4>
              <p class="text-muted">{{ customer().email }}</p>
            </div>
          </div>

          <div class="sidebar-card profile-nav">
            <nav class="profile-menu">
              <a class="menu-item" routerLink="/my-profile">
                <i class="bi bi-person-fill"></i>
                <span>Profil Bilgileri</span>
                <i class="bi bi-chevron-right"></i>
              </a>
              <a class="menu-item" routerLink="/change-password">
                <i class="bi bi-lock-fill"></i>
                <span>Şifre Değiştir</span>
                <i class="bi bi-chevron-right"></i>
              </a>
              <a class="menu-item active" routerLink="/rent-history">
                <i class="bi bi-clock-history"></i>
                <span>Kiralama Geçmişi</span>
                <i class="bi bi-chevron-right"></i>
              </a>
            </nav>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="col-lg-9">
        <div class="profile-content">
          <div class="content-header">
            <div class="d-flex justify-content-between align-items-start">
              <div class="w-100">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <h3 class="mb-0"><i class="bi bi-receipt text-primary me-2"></i>Rezervasyon Detayı</h3>
                  <button type="button" class="btn btn-outline-secondary btn-sm" (click)="back()">
                    <i class="bi bi-arrow-left me-1"></i>Geri
                  </button>
                </div>
                <p class="text-muted mb-0">
                  @if(reservation()){
                    {{ reservation()!.reservationNumber }} numaralı rezervasyonun detaylı bilgileri
                  }@else{
                    Rezervasyon detayları
                  }
                </p>
              </div>
            </div>
          </div>

          @if(reservationLoading()){
            <div class="p-3 text-muted">
              <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
              Yükleniyor...
            </div>
          }@else{
            @if(!reservation()){
              <div class="alert alert-light border">Rezervasyon bulunamadı.</div>
            }@else{
              <div class="reservation-detail-content">
                <div [class]="getStatusBannerClass(reservation()!.status)">
                  <div class="status-icon">
                    <i class="bi bi-check-circle-fill"></i>
                  </div>
                  <div class="status-info">
                    <h5>{{ getStatusTitle(reservation()!.status) }}</h5>
                    <p>Rezervasyon durum bilgisi</p>
                  </div>
                </div>

                <div class="detail-section">
                  <div class="section-header">
                    <h5><i class="bi bi-car-front text-primary me-2"></i>Araç ve Kiralama Bilgileri</h5>
                  </div>
                  <div class="section-content">
                    <div class="row g-4">
                      <div class="col-md-4">
                        <div class="car-preview">
                          <img [src]="vehicleImage()" [alt]="reservation()!.vehicle.brand + ' ' + reservation()!.vehicle.model" class="car-image">
                          <div class="car-title">
                            <h6>{{ reservation()!.vehicle.brand }} {{ reservation()!.vehicle.model }}</h6>
                            <div class="car-features">
                              @if(reservation()!.vehicle.transmission){
                                <span class="feature-badge">{{ reservation()!.vehicle.transmission }}</span>
                              }
                              @if(reservation()!.vehicle.fuelType){
                                <span class="feature-badge">{{ reservation()!.vehicle.fuelType }}</span>
                              }
                              @if(reservation()!.vehicle.seatCount){
                                <span class="feature-badge">{{ reservation()!.vehicle.seatCount }} Kişi</span>
                              }
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-8">
                        <div class="rental-details-grid">
                          <div class="detail-item">
                            <div class="detail-label">
                              <i class="bi bi-geo-alt-fill text-primary"></i>
                              Alış Yeri
                            </div>
                            <div class="detail-value">{{ reservation()!.pickUp.name }}</div>
                          </div>
                          <div class="detail-item">
                            <div class="detail-label">
                              <i class="bi bi-calendar-event text-primary"></i>
                              Alış Tarihi & Saati
                            </div>
                            <div class="detail-value">{{ reservation()!.pickUpDateTime | date:'dd.MM.yyyy HH:mm' }}</div>
                          </div>
                          <div class="detail-item">
                            <div class="detail-label">
                              <i class="bi bi-calendar-check text-primary"></i>
                              Dönüş Tarihi & Saati
                            </div>
                            <div class="detail-value">{{ reservation()!.deliveryDateTime | date:'dd.MM.yyyy HH:mm' }}</div>
                          </div>
                          <div class="detail-item">
                            <div class="detail-label">
                              <i class="bi bi-clock text-primary"></i>
                              Kiralama Süresi
                            </div>
                            <div class="detail-value">{{ reservation()!.totalDay }} Gün</div>
                          </div>
                          <div class="detail-item">
                            <div class="detail-label">
                              <i class="bi bi-hash text-primary"></i>
                              Rezervasyon No
                            </div>
                            <div class="detail-value">{{ reservation()!.reservationNumber }}</div>
                          </div>
                          <div class="detail-item">
                            <div class="detail-label">
                              <i class="bi bi-calendar-plus text-primary"></i>
                              Rezervasyon Tarihi
                            </div>
                            <div class="detail-value">{{ reservation()!.createdAt | date:'dd.MM.yyyy HH:mm' }}</div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="detail-section">
                  <div class="section-header">
                    <h5><i class="bi bi-person-fill text-primary me-2"></i>Sürücü Bilgileri</h5>
                  </div>
                  <div class="section-content">
                    <div class="row g-3">
                      <div class="col-md-6">
                        <div class="info-group">
                          <span class="d-block fw-bold mb-2 text-muted">Ana Sürücü</span>
                          <div class="driver-card">
                            <div class="driver-avatar">
                              <img
                                src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRNBRW6kw4PvewS5EGHKY7nNsJiWvrbsVIzZA&s"
                                [alt]="reservation()!.customer.fullName"
                              >
                            </div>
                            <div class="driver-info">
                              <h6>{{ reservation()!.customer.fullName }}</h6>
                              <p>T.C. Kimlik: {{ maskedIdentityNumber() }}</p>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="info-group">
                          <span class="d-block fw-bold mb-2 text-muted">İletişim Bilgileri</span>
                          <div class="contact-details">
                            <div class="contact-item">
                              <i class="bi bi-envelope"></i>
                              <span>{{ reservation()!.customer.email }}</span>
                            </div>
                            <div class="contact-item">
                              <i class="bi bi-telephone"></i>
                              <span>{{ reservation()!.customer.phoneNumber }}</span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="detail-section">
                  <div class="section-header">
                    <h5><i class="bi bi-shield-check text-primary me-2"></i>Güvence Paketi & Ekstralar</h5>
                  </div>
                  <div class="section-content">
                    <div class="row g-3">
                      <div class="col-md-6">
                        <div class="protection-package">
                          <div class="package-header">
                            <i class="bi bi-shield-fill-check text-success"></i>
                            <h6>{{ reservation()!.protectionPackageName }}</h6>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="extras-list">
                          <h6>Ek Hizmetler</h6>
                          @if(!reservation()!.reservationExtras || reservation()!.reservationExtras.length === 0){
                            <div class="extra-item"><span>Ek hizmet seçilmedi</span></div>
                          }@else{
                            @for(e of reservation()!.reservationExtras; track e.extraId){
                              <div class="extra-item">
                                <span>{{ e.extraName }}</span>
                              </div>
                            }
                          }
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="detail-section">
                  <div class="section-header">
                    <h5><i class="bi bi-credit-card text-primary me-2"></i>Ödeme Detayları</h5>
                  </div>
                  <div class="section-content">
                    <div class="row g-4">
                      <div class="col-md-6">
                        <div class="payment-method">
                          <h6>Ödeme Yöntemi</h6>
                          <div class="payment-card">
                            <i class="bi bi-credit-card-2-front text-primary"></i>
                            <div class="card-info">
                              <span class="card-type">Kredi Kartı</span>
                              <span class="card-number">{{ maskedCardNumber() }}</span>
                              <span class="card-holder">{{ reservation()!.paymentInformation.owner }}</span>
                            </div>
                            <div class="payment-status success">
                              <i class="bi bi-check-circle-fill"></i>
                              <span>Alındı</span>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="price-breakdown">
                          <h6>Fiyat Detayı</h6>
                          <div class="price-summary">
                            <div class="price-line">
                              <span>Araç Kirası ({{ reservation()!.totalDay }} gün)</span>
                              <span>{{ vehicleTotal() | number:'1.0-0' }} ₺</span>
                            </div>
                            <div class="price-line">
                              <span>Güvence Paketi</span>
                              <span>{{ protectionTotal() | number:'1.0-0' }} ₺</span>
                            </div>
                            <div class="price-line">
                              <span>Ekstralar</span>
                              <span>{{ extrasTotal() | number:'1.0-0' }} ₺</span>
                            </div>
                            <div class="price-line total">
                              <span>TOPLAM</span>
                              <span>{{ reservation()!.total | number:'1.0-0' }} ₺</span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="detail-section">
                  <div class="section-header">
                    <h5><i class="bi bi-geo-alt text-primary me-2"></i>Teslim Alma Bilgileri</h5>
                  </div>
                  <div class="section-content">
                    <div class="location-info">
                      <div class="location-header">
                        <h6>{{ reservation()!.pickUp.name }}</h6>
                      </div>
                      <div class="location-details">
                        @if(reservation()!.pickUp.fullAddress){
                          <div class="detail-item">
                            <i class="bi bi-geo-alt-fill"></i>
                            <span>{{ reservation()!.pickUp.fullAddress }}</span>
                          </div>
                        }
                        @if(reservation()!.pickUp.phoneNumber){
                          <div class="detail-item">
                            <i class="bi bi-telephone"></i>
                            <span>{{ reservation()!.pickUp.phoneNumber }}</span>
                          </div>
                        }
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            }
          }
        </div>
      </div>
    </div>
  </div>
</section>
