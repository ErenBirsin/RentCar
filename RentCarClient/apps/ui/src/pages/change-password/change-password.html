<!-- Header -->
<section class="profile-header py-4 bg-primary text-white">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-8">
        <div class="profile-welcome">
          <div class="user-avatar">
            <img
              src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRNBRW6kw4PvewS5EGHKY7nNsJiWvrbsVIzZA&s"
              [alt]="fullName()"
              class="avatar-img"
            />
            <div class="avatar-badge">
              <i class="bi bi-check-circle-fill"></i>
            </div>
          </div>
          <div class="welcome-text">
            <h1 class="h2 mb-1">Hoş geldin, {{ customer().firstName }}!</h1>
            <p class="mb-0">Hesabının güvenliği için şifreni buradan değiştirebilirsin</p>
          </div>
        </div>
      </div>
      <div class="col-lg-4 text-lg-end">
        <div class="language-links">
          <a role="button"
             class="text-light"
             tabindex="0"
             (click)="logout()"
             (keyup.enter)="logout()"
             (keyup.space)="logout()">
            <i class="bi bi-box-arrow-right me-1"></i>Çıkış Yap
          </a>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Main Content -->
<section class="profile-main py-5">
  <div class="container">
    <div class="row">
      <!-- Sidebar -->
      <div class="col-lg-3">
        <div class="profile-sidebar">
          <div class="sidebar-card user-info">
            <div class="user-avatar-large">
              <img
                src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRNBRW6kw4PvewS5EGHKY7nNsJiWvrbsVIzZA&s"
                [alt]="fullName()"
                class="avatar-img"
              />
            </div>
            <div class="user-details">
              <h4>{{ fullName() }}</h4>
              <p class="text-muted">{{ customer().email }}</p>
            </div>
          </div>

          <div class="sidebar-card profile-nav">
            <nav class="profile-menu">
              <a class="menu-item" routerLink="/my-profile">
                <i class="bi bi-person-fill"></i>
                <span>Profil Bilgileri</span>
                <i class="bi bi-chevron-right"></i>
              </a>
              <a class="menu-item active" routerLink="/change-password">
                <i class="bi bi-lock-fill"></i>
                <span>Şifre Değiştir</span>
                <i class="bi bi-chevron-right"></i>
              </a>
            </nav>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="col-lg-9">
        <div class="profile-content">
          <div class="content-header">
            <h3><i class="bi bi-lock-fill text-primary me-2"></i>Şifre Değiştir</h3>
            <p class="text-muted">Hesabının güvenliği için güçlü bir şifre kullan</p>
          </div>

          <div class="security-alert">
            <div class="alert alert-info d-flex align-items-start">
              <i class="bi bi-shield-check fs-4 text-info me-3 mt-1"></i>
              <div>
                <h6 class="alert-heading mb-2">Güvenlik Önerileri</h6>
                <ul class="mb-0 small">
                  <li>Şifren en az 8 karakter uzunluğunda olmalı</li>
                  <li>Büyük harf, küçük harf, rakam ve özel karakter içermeli</li>
                  <li>Daha önce kullandığın şifrelerden farklı olmalı</li>
                </ul>
              </div>
            </div>
          </div>

          <form class="password-form" (ngSubmit)="onSubmit()">
            <div class="form-section">
              <div class="section-header">
                <h5><i class="bi bi-key text-primary me-2"></i>Mevcut Şifre</h5>
                <small class="text-muted">Güvenlik için önce mevcut şifreni gir</small>
              </div>
              <div class="section-content">
                <div class="row">
                  <div class="col-md-8">
                    <label for="currentPassword" class="form-label">Mevcut Şifre *</label>
                    <div class="input-group">
                      <span class="input-group-text">
                        <i class="bi bi-lock"></i>
                      </span>
                      <input
                        id="currentPassword"
                        #currentPasswordEl
                        type="password"
                        class="form-control"
                        placeholder="Mevcut şifreni gir"
                        [ngModel]="currentPassword()"
                        (ngModelChange)="currentPassword.set($event)"
                        name="currentPassword"
                        required
                      >
                      <button type="button" class="input-group-text password-toggle" (click)="toggleCurrentPassword()">
                        <i class="bi bi-eye"></i>
                      </button>
                    </div>
                  </div>
                </div>
                <div class="mt-2">
                  <a routerLink="/login" class="small text-muted">Şifremi unuttum</a>
                </div>
              </div>
            </div>

            <div class="form-section">
              <div class="section-header">
                <h5><i class="bi bi-shield-lock text-primary me-2"></i>Yeni Şifre</h5>
                <small class="text-muted">Güvenli ve hatırlanabilir yeni şifreni belirle</small>
              </div>
              <div class="section-content">
                <div class="row g-3">
                  <div class="col-md-8">
                    <label for="newPassword" class="form-label">Yeni Şifre *</label>
                    <div class="input-group">
                      <span class="input-group-text">
                        <i class="bi bi-shield-lock"></i>
                      </span>
                      <input
                        id="newPassword"
                        #newPasswordEl
                        type="password"
                        class="form-control"
                        placeholder="Yeni şifreni gir"
                        [ngModel]="newPassword()"
                        (ngModelChange)="newPassword.set($event)"
                        name="newPassword"
                        required
                      >
                      <button type="button" class="input-group-text password-toggle" (click)="toggleNewPassword()">
                        <i class="bi bi-eye"></i>
                      </button>
                    </div>

                    <div class="password-strength mt-3">
                      <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="strength-label">Şifre Gücü:</span>
                        <span class="strength-text" [ngClass]="passwordStrength().class">{{ passwordStrength().text }}</span>
                      </div>
                      <div class="strength-bars">
                        <div
                          class="strength-bar"
                          [class.active]="passwordStrength().level >= 1"
                          [class.weak]="passwordStrength().class === 'weak' && passwordStrength().level >= 1"
                          [class.medium]="passwordStrength().class === 'medium' && passwordStrength().level >= 1"
                          [class.strong]="passwordStrength().class === 'strong' && passwordStrength().level >= 1"
                        ></div>
                        <div
                          class="strength-bar"
                          [class.active]="passwordStrength().level >= 2"
                          [class.weak]="passwordStrength().class === 'weak' && passwordStrength().level >= 2"
                          [class.medium]="passwordStrength().class === 'medium' && passwordStrength().level >= 2"
                          [class.strong]="passwordStrength().class === 'strong' && passwordStrength().level >= 2"
                        ></div>
                        <div
                          class="strength-bar"
                          [class.active]="passwordStrength().level >= 3"
                          [class.weak]="passwordStrength().class === 'weak' && passwordStrength().level >= 3"
                          [class.medium]="passwordStrength().class === 'medium' && passwordStrength().level >= 3"
                          [class.strong]="passwordStrength().class === 'strong' && passwordStrength().level >= 3"
                        ></div>
                        <div
                          class="strength-bar"
                          [class.active]="passwordStrength().level >= 4"
                          [class.weak]="passwordStrength().class === 'weak' && passwordStrength().level >= 4"
                          [class.medium]="passwordStrength().class === 'medium' && passwordStrength().level >= 4"
                          [class.strong]="passwordStrength().class === 'strong' && passwordStrength().level >= 4"
                        ></div>
                      </div>
                    </div>

                    <div class="password-requirements mt-3">
                      <h6 class="requirements-title">Şifre Gereksinimleri:</h6>
                      <div class="requirements-list">
                        <div class="requirement-item">
                          <i class="bi" [ngClass]="passwordRequirements().minLength ? 'bi-check-circle text-success' : 'bi-x-circle text-danger'"></i>
                          <span>En az 8 karakter</span>
                        </div>
                        <div class="requirement-item">
                          <i class="bi" [ngClass]="passwordRequirements().hasLowerCase ? 'bi-check-circle text-success' : 'bi-x-circle text-danger'"></i>
                          <span>Küçük harf (a-z)</span>
                        </div>
                        <div class="requirement-item">
                          <i class="bi" [ngClass]="passwordRequirements().hasUpperCase ? 'bi-check-circle text-success' : 'bi-x-circle text-danger'"></i>
                          <span>Büyük harf (A-Z)</span>
                        </div>
                        <div class="requirement-item">
                          <i class="bi" [ngClass]="passwordRequirements().hasNumber ? 'bi-check-circle text-success' : 'bi-x-circle text-danger'"></i>
                          <span>Rakam (0-9)</span>
                        </div>
                        <div class="requirement-item">
                          <i class="bi" [ngClass]="passwordRequirements().hasSpecialChar ? 'bi-check-circle text-success' : 'bi-x-circle text-danger'"></i>
                          <span>Özel karakter</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row g-3 mt-3">
                  <div class="col-md-8">
                    <label for="confirmPassword" class="form-label">Yeni Şifre Tekrarı *</label>
                    <div class="input-group">
                      <span class="input-group-text">
                        <i class="bi bi-shield-check"></i>
                      </span>
                      <input
                        id="confirmPassword"
                        #confirmPasswordEl
                        type="password"
                        class="form-control"
                        placeholder="Yeni şifreni tekrar gir"
                        [ngModel]="confirmPassword()"
                        (ngModelChange)="confirmPassword.set($event)"
                        name="confirmPassword"
                        required
                      >
                      <button type="button" class="input-group-text password-toggle" (click)="toggleConfirmPassword()">
                        <i class="bi bi-eye"></i>
                      </button>
                    </div>

                    <div class="password-match mt-2">
                      @if(passwordsMatch()){
                        <div class="match-indicator">
                          <i class="bi bi-check-circle text-success me-1"></i>
                          <span class="text-success">Şifreler eşleşiyor</span>
                        </div>
                      }@else if(confirmPassword().length > 0){
                        <div class="no-match-indicator">
                          <i class="bi bi-x-circle text-danger me-1"></i>
                          <span class="text-danger">Şifreler eşleşmiyor</span>
                        </div>
                      }
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-section">
              <div class="section-header">
                <h5><i class="bi bi-gear-fill text-primary me-2"></i>Ek Güvenlik Seçenekleri</h5>
                <small class="text-muted">İstersen şifre değişikliğinden sonra tüm cihazlardan çıkış yap</small>
              </div>
              <div class="section-content">
                <div class="security-options">
                  <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="logoutAllDevices" [ngModel]="logoutAllDevices()" (ngModelChange)="logoutAllDevices.set($event)" name="logoutAllDevices">
                    <label class="form-check-label" for="logoutAllDevices">
                      <strong>Tüm cihazlardan çıkış yap</strong>
                      <small class="d-block text-muted">Diğer cihazlardaki oturumları sonlandır</small>
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <div class="d-flex justify-content-between align-items-center">
                <div class="form-info"></div>
                <div class="action-buttons">
                  <a routerLink="/my-profile" class="btn btn-outline-secondary me-2">
                    <i class="bi bi-arrow-left me-1"></i>İptal
                  </a>
                  <button type="submit" class="btn btn-primary" [disabled]="saving() || !isFormValid()">
                    @if(saving()){
                      <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                    }
                    <i class="bi bi-shield-check me-1"></i>Şifreyi Değiştir
                  </button>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>
